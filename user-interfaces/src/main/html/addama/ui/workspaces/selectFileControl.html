<html>
<head>
    <title>Workspace</title>
    <link rel="stylesheet" type="text/css" href="/addama/ui/ext-js-3.2.1/resources/css/ext-all.css">
    <link rel="stylesheet" type="text/css" href="/addama/ui/ext-js-3.2.1/examples/shared/examples.css"/>
    <link rel="stylesheet" type="text/css" href="/addama/ui/ext-js-3.2.1/examples/ux/fileuploadfield/css/fileuploadfield.css"/>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/ext-all.js"></script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/examples/ux/fileuploadfield/FileUploadField.js"></script>
    <script type="text/javascript" src="/addama/ui/console_handling.js"></script>
    <script type="text/javascript" src="/addama/ui/workspaces/selectFileControlHelper.js"></script>

    <!-- page specific -->
    <script type="text/javascript">
        var workspace = null;
        var selectedFile = null;
        var selectedDir = null;

        function loadWorkspace() {
            var queryString = decodeURI(window.location.search.substring(1));
            if (queryString) {
                if (queryString.indexOf("=") > 0) {
                    var params = queryString.split("workspace=");
                    workspace = params[1];
                    selectFile({
                        attributes: {},
                        id: workspace
                    });
                    refreshTree();
                }
            }
        }
        
        function selectFile(node) {
            if (node.attributes.isFile) {
               selectedFile = node.id;
            } else {
               selectedDir = node.id;
            }
        }

        function sendSelectedFile() {
            console.log("sendSelectedFile:" + selectedFile);
            this.parent.selectFileControl.selectFile(selectedFile);
        }

        function uploadFile() {
            loadUploadFormPanel(selectedDir, "container_uploadform", refreshTree);
        }

        function createFolder() {
            openCreateFolderPanel(selectedDir, refreshTree);
        }

        function refreshTree() {
            loadTree(workspace, "container_tree");
        }

        Ext.onReady(loadWorkspace);
    </script>
    <style type="text/css">
        #container_tree {
            overflow:auto;
            width:700px;
            height:500px;
            border:1px solid #c3daf9;
        }
    </style>
</head>
<body>
    <button onclick="sendSelectedFile();">Select File</button>

    <div id="container_uploadform"></div>
    <div id="container_tree"></div>

    <button onclick="createFolder();">Create Folder</button>
    <button onclick="uploadFile();">Upload File</button>    
</body>
</html>

