<html>
<head>
    <title>Request Addama Access</title>
    <script type="text/javascript" src="/addama/ui/prototype-1.6.0.3.js"></script>
    <script type="text/javascript" src="/addama/ui/console_handling.js"></script>
    <script type="text/javascript">
       function requestAccess(){
           try {
               var requestedUri = getUri();
               if (requestedUri) {
                   new Ajax.Request("/addama/whitelist", {
                       method: "post",
                       parameters: {
                           uri: requestedUri
                       },
                       onSuccess: function() {
                           alert("Request sent successfully");
                       },
                       onFailure: handleFailure,
                       onException: handleFailure
                   });
               }               
           } catch (err) {
               console.log(err);
           }
       }

       function getUri() {
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++) {
                var hash = hashes[i].split('=');
                if (hash[0] == "uri") {
                    return hash[1];
                }
            }
            return null;
        }

       function handleFailure(){
           alert("Request was unsuccessful");
       }

    </script>
</head>
<body>
    <h3>Unauthorized Access</h3>
    <p>Access to addama is restricted.  Please click the submit button if you would like to request access to the application.</p>
    <br><button type="button" onclick="requestAccess()" >Request Access</button>
</body>
</html>