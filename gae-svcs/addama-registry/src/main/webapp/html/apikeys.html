<html>
<head>
    <title>Addama API Key</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" type="text/css" href="https://informatics-apps.systemsbiology.net/ext-js-3.3.1/resources/css/ext-all.css">
    <link rel="stylesheet" type="text/css" href="https://informatics-apps.systemsbiology.net/ext-js-3.3.1/examples/shared/examples.css"/>
    <script type="text/javascript" src="https://informatics-apps.systemsbiology.net/ext-js-3.3.1/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="https://informatics-apps.systemsbiology.net/ext-js-3.3.1/ext-all.js"></script>
    <script type="text/javascript" src="/js/utils/query_parameters.js"></script>
    <script type="text/javascript" src="/js/apis/topbar.js"></script>

    <style type="text/css">
        #container_topbar {
            width: 100%;
            height: 20px;
            border: 1px solid #c3daf9;
        }

    </style>
    <script type="text/javascript">
        Ext.onReady(function() {
            new org.systemsbiology.addama.js.TopBar({
                contentEl: "container_topbar",
                listeners: {
                    whoami: function(json) {
                        if (json.isAdmin) {
                            Ext.get("container_addama_properties").setVisible(true);
                        }
                    }
                }
            });
        });

        Ext.onReady(function() {
            Ext.Ajax.request({
                url: "/addama/apikeys",
                method: "GET",
                success: function(o) {
                    var json = Ext.util.JSON.decode(o.responseText);
                    Ext.getDom("container_apikey").innerHTML = json.apikey;
                },
                failure: function(o, e) {
                    Ext.MessageBox.show({
                        title: "Error Retrieving API Key",
                        msg: o + "<br/>" + e,
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });
                }
            });
        });

        function SubmitHostUrl() {
            var serviceUrl = Ext.getDom("i_service_url").value;
            if (serviceUrl) {
                document.location = "/addama/apikeys/addama.properties?serviceUrl=" + serviceUrl;
            } else {
                document.location = "/addama/apikeys/addama.properties";
            }
        }
    </script>
</head>
<body>
<div id="container_topbar"></div>

<div id="container_toolbar">
    <div>
        <strong>API Key</strong>: <span id="container_apikey"></span>
    </div>
    <div>
        <a href="/addama/apikeys/file" target="_blank">Download API Key File</a>
    </div>
    <div id="container_addama_properties" style="display:none;">
        <label for="i_service_url">Enter Service Host URL</label>
        <input type="text" id="i_service_url"/>
        <br/>
        <button onclick="SubmitHostUrl();">Download addama.properties</button>
    </div>
</div>

<div id="container_footer">
    Generated API Keys are managed by domain administrators through the App Engine Administration Console
</div>
</body>
</html>